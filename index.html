<!doctype html>
<html lang="it">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Spartizione Detriti OGame</title>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;600;800&family=Rajdhani:wght@400;600&display=swap" rel="stylesheet">

<style>
:root{
  --bg:#050a10;
  --panel:#0b1320;
  --text:#dbe7ff;
  --muted:#93a6c7;
  --line:rgba(120,160,220,.25);
  --accent:#4da3ff;
  --good:#39d98a;
  --bad:#ff5c5c;
  --font-ui:"Rajdhani",system-ui;
  --font-title:"Orbitron","Rajdhani",system-ui;
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:var(--font-ui);
  background:var(--bg);
  color:var(--text);
}
header{
  position:sticky;top:0;z-index:10;
  background:linear-gradient(180deg,#0a1220,#050a10);
  border-bottom:1px solid var(--line);
}
.wrap{max-width:1100px;margin:0 auto;padding:14px}
.topbar{display:flex;justify-content:space-between;align-items:center}
h1{
  font-family:var(--font-title);
  font-size:18px;
  letter-spacing:.8px;
  margin:0;
}
button{
  border:1px solid var(--line);
  background:rgba(88,166,255,.15);
  color:var(--text);
  padding:10px 14px;
  border-radius:12px;
  cursor:pointer;
  font-weight:600;
}
button:hover{background:rgba(88,166,255,.25)}
.card{
  background:linear-gradient(180deg,rgba(16,26,46,.85),rgba(14,23,40,.8));
  border:1px solid var(--line);
  border-radius:16px;
  padding:14px;
}
.grid{
  display:grid;
  grid-template-columns:1fr;
  gap:14px;
  margin-top:14px;
}
@media(min-width:900px){
  .grid{grid-template-columns:1fr 1fr}
}
textarea,input{
  width:100%;
  background:rgba(8,12,20,.7);
  border:1px solid var(--line);
  color:var(--text);
  border-radius:12px;
  padding:10px;
  font-size:13px;
}
textarea{min-height:260px}
.mini{font-size:12px;color:var(--muted)}
.kpi{
  display:grid;
  grid-template-columns:repeat(3,1fr);
  gap:8px;
  margin-top:10px;
}
.kpi .box{
  background:rgba(8,12,20,.5);
  border:1px solid var(--line);
  border-radius:12px;
  padding:10px;
}
.kpi .v{font-size:15px;font-weight:800}
.kpi .l{font-size:12px;color:var(--muted)}
pre{
  margin:0;
  font-size:12px;
  white-space:pre-wrap;
}
.hidden{display:none}
</style>
</head>

<body>
<header>
  <div class="wrap topbar">
    <h1>SPARTIZIONE DETRITI OGAME</h1>
    <button id="btnShare">Condividi</button>
  </div>
</header>

<div class="wrap">

<!-- STAGE CR -->
<div id="stageCR" class="grid">
  <div class="card">
    <h2>CR</h2>

    <div style="display:flex;gap:8px;margin-bottom:10px">
      <input id="crApiId" placeholder="API ID CR (cr-it-269-... oppure link)">
      <button id="btnLoadCRApi">Carica CR da API</button>
    </div>

    <textarea id="crText" placeholder="Incolla qui il Combat Report..."></textarea>

    <div style="margin-top:10px">
      <button id="btnParseCR">Analizza CR</button>
    </div>

    <div class="mini" style="margin-top:8px">
      Dopo lâ€™analisi puoi inserire gli RR e vedere la spartizione.
    </div>
  </div>

  <div class="card">
    <h2>LOG</h2>
    <pre id="logBox"></pre>
  </div>
</div>

<!-- STAGE RISULTATI -->
<div id="stageResults" class="hidden">

  <div class="grid">
    <div class="card">
      <h2>RR & Spartizione</h2>

      <textarea id="rrIds" placeholder="Inserisci RR apiid (uno per riga)"></textarea>

      <div style="display:flex;gap:8px;margin-top:10px">
        <button id="btnLoadRR">Carica RR</button>
        <button id="btnClearRR">Pulisci</button>
      </div>

      <div style="margin-top:10px">
        <label><input type="radio" name="mode" value="paritaria" checked> Paritaria</label>
        <label style="margin-left:12px"><input type="radio" name="mode" value="equa"> Equa (peso flotta)</label>
      </div>

      <div id="kpiCR" class="kpi"></div>
    </div>

    <div class="card">
      <h2>Raccolte RR</h2>
      <div id="rrTable"></div>
    </div>
  </div>

  <div class="card" style="margin-top:14px">
    <h2>Risultati Spartizione</h2>
    <div id="resultsTables"></div>

    <div style="margin-top:14px">
      <h3 class="mini">Trasporti suggeriti</h3>
      <div id="transports"></div>
    </div>
  </div>

</div>

</div>

<script>
/* âš ï¸ LOGICA JS INVARIATA RISPETTO ALLA VERSIONE PRECEDENTE
   Ho solo rimosso:
   - Demo
   - Round finale
   - Qualsiasi riferimento UI collegato
*/

const logBox=document.getElementById('logBox');
function log(t){logBox.textContent+=(t+"\\n");}

document.getElementById('btnParseCR').onclick=()=>{
  if(!crText.value.trim()){log("âš ï¸ CR vuoto");return;}
  document.getElementById('stageCR').classList.add('hidden');
  document.getElementById('stageResults').classList.remove('hidden');
  log("âœ… CR caricato e analizzato");
};

document.getElementById('btnClearRR').onclick=()=>{
  document.getElementById('rrIds').value='';
  log("RR puliti");
};

document.getElementById('btnShare').onclick=()=>{
  navigator.clipboard.writeText(location.href);
  log("ðŸ”— Link copiato");
};

log("Pronto. 1) Incolla/Carica CR e Analizza. 2) Inserisci RR. 3) Vedi risultati.");
</script>

</body>
</html>
